{{/* cspell:disable */}}
{{- $pctx := . -}}
{{- if .IsHome -}}{{ $pctx = .Site }}{{- end -}}
{{- $pages := slice -}}
{{- if or $.IsHome $.IsSection -}}
{{- $pages = where $pctx.RegularPages "Type" "in" site.Params.mainSections -}}
{{- else -}}
{{- $pages = where $pctx.Pages "Type" "in" site.Params.mainSections -}}
{{- end -}}
{{- $limit := .Site.Config.Services.RSS.Limit -}}
{{- if ge $limit 1 -}}
{{- $pages = $pages | first $limit -}}
{{- end -}}
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>{{- .Site.Title -}}</title>
    <description>{{- .Site.Params.description | default .Site.Title -}}</description>
    {{- with resources.Get .Site.Params.feed.rss.image }}
    <image>
      <url>{{- .Permalink -}}</url>
      <title>{{- $.Site.Title -}}</title>
      <link>{{- $.Site.BaseURL -}}</link>
    </image>
    {{- else }}
    {{- warnf "RSS image not found" }}
    {{- end }}
    <link>{{- $.Site.BaseURL -}}</link>
    {{ with .OutputFormats.Get "rss" -}}
    <atom:link href="{{- .Permalink -}}" rel="self" type="application/rss+xml" />
    {{- end }}
    <generator>Hugo -- gohugo.io</generator>
    {{ with .Site.LanguageCode -}}
    <language>{{- . -}}</language>
    {{- end }}
    {{ with .Site.Author.email -}}
    <managingEditor>
      {{- . }}{{ with $.Site.Author.displayname }} ({{ . }}){{ end -}}
    </managingEditor>
    <webMaster>
      {{- . }}{{ with $.Site.Author.displayname }} ({{ . }}){{ end -}}
    </webMaster>
    {{- end }}
    {{ with .Site.Copyright -}}
    <copyright>{{- printf . now.Year | safeHTML -}}</copyright>
    {{- end }}
    {{ if not .Date.IsZero -}}
    <lastBuildDate>
      {{- .Date.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML -}}
    </lastBuildDate>
    {{- end }}
    {{ range $pages -}}
    <item>
      <title>{{- .Page.Title -}}</title>
      <link>{{- .Page.Permalink -}}</link>
      {{- with .Page.Resources.GetMatch "featured-image" }}
      <enclosure url="{{- .Permalink -}}" length="{{- .Content | len -}}" type="{{- .MediaType.Type -}}" />
      {{- end }}
      <pubDate>
        {{- .Page.Date.Format "Mon, 02 Jan 2006 15:04:05 -0700"  | safeHTML -}}
      </pubDate>
      {{ with $.Site.Author.email -}}
      <author>{{- . -}}{{- with $.Site.Author.displayname }} ({{- . -}}){{- end -}}</author>
      {{- end }}
      <guid>{{ .Page.Permalink }}</guid>
      <description>
        {{ trim (.Page.Summary | plainify | htmlUnescape) "\r\n" }}
      </description>
      <content:encoded>
        {{ printf "<![CDATA[" | safeHTML }}
        {{ $content := .Page.Description -}}
        {{- if .Site.Params.rssFullText -}}
          {{- $content = .Page.Content -}}
        {{- else -}}
          {{- with .Page.Summary -}}
            {{- $content = . -}}
          {{- end -}}
        {{- end -}}
        {{- $content }}
        {{ printf "]]>" | safeHTML }}
      </content:encoded>
    </item>
    {{- end }}
  </channel>
</rss>

name: Integration
on:
  push:
    paths-ignore:
    - .frontmatter/*
    - .github/*
    - .vscode/*
    paths:
    - .github/workflows/integration.yaml
env:
  GOLANG_VERSION: 1.21
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@v4
    - name: setup golang
      uses: actions/setup-go@v3
      with:
        go-version: ${{ env.GOLANG_VERSION }}
    - name: install nix
      uses: DeterminateSystems/nix-installer-action@main
    - name: cache nix
      uses: DeterminateSystems/magic-nix-cache-action@main
    - name: check flake
      uses: DeterminateSystems/flake-checker-action@main
    - name: check source
      run: nix develop -c lefthook run pre-commit --all-files --no-tty
